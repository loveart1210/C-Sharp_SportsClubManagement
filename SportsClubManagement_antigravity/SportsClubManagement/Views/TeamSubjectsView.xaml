<UserControl x:Class="SportsClubManagement.Views.TeamSubjectsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:conv="clr-namespace:SportsClubManagement.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <conv:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Margin="25">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="1.5*"/>
        </Grid.ColumnDefinitions>

        <!-- List Subjects -->
        <DockPanel Grid.Column="0" Margin="0,0,20,0">
            <!-- Header & Search -->
            <StackPanel DockPanel.Dock="Top" Margin="0,0,0,20">
                <TextBlock Text="Danh sÃ¡ch mÃ´n táº­p" FontSize="24" FontWeight="Bold" Foreground="#1976D2" Margin="0,0,0,15"/>
                
                <Border BorderBrush="#CCCCCC" BorderThickness="1" Background="White" Width="300" Height="36" HorizontalAlignment="Left">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="ðŸ”" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#999"/>
                        <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource SearchTextBoxStyle}" Tag="TÃ¬m kiáº¿m mÃ´n táº­p..."/>
                    </Grid>
                </Border>
            </StackPanel>

            <Grid>
                <DataGrid ItemsSource="{Binding Subjects}" SelectedItem="{Binding SelectedSubject}" 
                          Style="{StaticResource ModernDataGridStyle}">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="MÃ´n táº­p" Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Left" Margin="10,0">
                                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="#333" HorizontalAlignment="Left"/>
                                        <TextBlock Text="{Binding Description}" FontSize="12" Foreground="#888" TextTrimming="CharacterEllipsis" MaxWidth="300" HorizontalAlignment="Left"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="Thao tÃ¡c" Width="Auto">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Visibility="{Binding DataContext.IsFounderOrCoach, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Button Content="Sá»­a" Style="{StaticResource ModernButtonStyle}"
                                                Command="{Binding DataContext.EditSubjectCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                CommandParameter="{Binding}"
                                                Background="#E3F2FD" Foreground="#1976D2" Padding="8,4"/>
                                        <Button Content="XÃ³a" Style="{StaticResource ModernButtonStyle}"
                                                Command="{Binding DataContext.RemoveSubjectCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                CommandParameter="{Binding}"
                                                Background="#FFEBEE" Foreground="#C62828" Margin="5,0,0,0" Padding="8,4"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </DockPanel>

        <!-- Create/Edit Subject Form -->
        <Border Grid.Column="1" BorderBrush="#DDD" BorderThickness="1" Padding="15" VerticalAlignment="Top" Background="#F9F9F9"
                Visibility="{Binding IsFounderOrCoach, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
                <TextBlock Text="{Binding FormTitle}" FontSize="18" FontWeight="Bold" Foreground="#333" Margin="0,0,0,15"/>
                
                <TextBlock Text="TÃªn mÃ´n táº­p" FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,5"/>
                <Border BorderBrush="#CCCCCC" BorderThickness="1" Height="36" Margin="0,0,0,10" Background="White">
                    <TextBox Text="{Binding NewSubjectName, UpdateSourceTrigger=PropertyChanged}" 
                             Style="{StaticResource SearchTextBoxStyle}" Tag="Nháº­p tÃªn mÃ´n táº­p..."/>
                </Border>
                
                <TextBlock Text="MÃ´ táº£" FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,5"/>
                <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,0,15" Background="White">
                    <TextBox Text="{Binding NewSubjectDesc}" AcceptsReturn="True" TextWrapping="Wrap"
                             BorderThickness="0" Background="Transparent" Padding="8" MinHeight="80"/>
                </Border>
                
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                     <Button Content="Há»§y" Command="{Binding CancelEditCommand}" 
                            Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Style="{StaticResource ModernButtonStyle}" Background="#E0E0E0" Foreground="#333" Margin="0,0,10,0" Padding="12,6"/>
                
                    <Button Content="{Binding ButtonText}" Command="{Binding AddSubjectCommand}" 
                            Style="{StaticResource ModernButtonStyle}" Background="#4CAF50" Foreground="White" MinWidth="80" Padding="12,6"/>
                </StackPanel>
            </StackPanel>
        </Border>
        
        <!-- Member Read-only Mode -->
        <Border Grid.Column="1" BorderBrush="#DDD" BorderThickness="1" Padding="15" VerticalAlignment="Top" Background="#F9F9F9"
                Visibility="{Binding IsFounderOrCoach, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
             <StackPanel>
                 <TextBlock Text="ThÃ´ng tin" FontSize="18" FontWeight="Bold" Foreground="#333" Margin="0,0,0,10"/>
                 <TextBlock Text="Báº¡n Ä‘ang xem danh sÃ¡ch mÃ´n táº­p cá»§a team." Foreground="#666" TextWrapping="Wrap" Margin="0,0,0,5"/>
                 <TextBlock Text="Chá»‰ NgÆ°á»i sÃ¡ng láº­p hoáº·c Huáº¥n luyá»‡n viÃªn má»›i cÃ³ quyá»n chá»‰nh sá»­a." 
                            FontStyle="Italic" Foreground="#888" TextWrapping="Wrap" FontSize="11"/>
             </StackPanel>
        </Border>
    </Grid>
</UserControl>
